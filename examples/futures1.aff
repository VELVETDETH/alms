(* An example with futures *)

#load "libthread-A.aff"

open AThread

let[A] prompt : unit -> string future =
  fun _:unit -> Future.new getLine

let[C] printDots : int -> int -> unit =
  let rec loop (count : int) (delay : int) : unit =
    if count <= 0
      then ()
      else
        putStr ".";
        flush ();
        threadDelay (1000 * delay);
        loop (count - 1) delay
  in loop

let[A] main : string -> unit =
  fun message: string ->
    putStrLn message;
    let future = prompt () in
      printDots 80 20;
      putStrLn "";
      putStrLn (Future.get future)

in main "whadday say? "
